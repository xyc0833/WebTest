# JavaWeb-Servlet-Learning
âœ¨ åˆå¿ƒè€…å‘ã‘JavaWeb Servletã®æ ¸å¿ƒçŸ¥è­˜ã‚’ä½“ç³»çš„ã«å­¦ã¶ãŸã‚ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã™ã€‚ç’°å¢ƒæ§‹ç¯‰ã‹ã‚‰å®Ÿè·µä¾‹ã¾ã§å®Œå…¨ãªãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å«ã¿ã¾ã™ã€‚

## ğŸ“š å­¦ç¿’å†…å®¹
- ServletåŸºç¤ï¼šãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã€æ ¸å¿ƒãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆinit/doGet/doPost/destroyï¼‰
- ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®šï¼š@WebServletã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨ã¨ãƒ‘ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°
- ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè·µï¼šIDEA + Tomcat 11ï¼ˆJakarta EEï¼‰ã«ã‚ˆã‚‹Servletãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‡ãƒ—ãƒ­ã‚¤
- ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼š404ã‚¨ãƒ©ãƒ¼/ãƒãƒ¼ãƒˆå ç”¨/ãƒ‡ãƒ—ãƒ­ã‚¤å¤±æ•—ãªã©ã®å¸¸è¦‹å•é¡Œã®è§£æ±ºç­–
- æ ¸å¿ƒAPIï¼šHttpServletRequest/HttpServletResponseã®ä½¿ç”¨æ–¹æ³•

## ğŸ›  ç’°å¢ƒè¨­å®š
- JDKï¼š17+ï¼ˆJakarta EE 10ã«å¯¾å¿œï¼‰
- ã‚µãƒ¼ãƒãƒ¼ï¼šApache Tomcat 11.0.18
- é–‹ç™ºãƒ„ãƒ¼ãƒ«ï¼šIntelliJ IDEA
- è¦æ ¼ï¼šJakarta Servlet 6.0

## ğŸ“ å®Ÿè·µä¾‹
- åŸºç¤çš„ãªHelloWorld Servletï¼ˆã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³/XMLã®2é€šã‚Šã®è¨­å®šæ–¹å¼ï¼‰
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—ã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‡ãƒ¼ã‚¿ã®è¿”å´
- Servletã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

## â“ å¸¸è¦‹å•é¡Œ
å­¦ç¿’éç¨‹ã§é­é‡ã—ãŸå…¸å‹çš„ãªå•é¡Œã‚’è¨˜éŒ²ã—ã¦ã„ã¾ã™ï¼š
- Tomcatãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®404ã‚¨ãƒ©ãƒ¼ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- 8080ãƒãƒ¼ãƒˆå ç”¨ã®è§£æ±ºç­–
- Jakartaã¨ä¼çµ±çš„ãªjavax.servletã®äº’æ›æ€§å¯¾å¿œ


## å­¦ä¹ ç¬”è®°

ä¸€ä¸ªServletçš„ç”Ÿå‘½å‘¨æœŸä¸ºï¼š

é¦–å…ˆæ‰§è¡Œæ„é€ æ–¹æ³•å®Œæˆ Servlet åˆå§‹åŒ–
Servlet åˆå§‹åŒ–åè°ƒç”¨ init () æ–¹æ³•ã€‚
Servlet è°ƒç”¨ service() æ–¹æ³•æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚
Servlet é”€æ¯å‰è°ƒç”¨ destroy() æ–¹æ³•ã€‚
æœ€åï¼ŒServlet æ˜¯ç”± JVM çš„åƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚


æˆ‘ä»¬å‘ç°serviceæ–¹æ³•ä¸­ï¼Œè¿˜æœ‰ä¸¤ä¸ªå‚æ•°ï¼ŒServletRequestå’ŒServletResponseï¼Œ
å®é™…ä¸Šï¼Œç”¨æˆ·å‘èµ·çš„HTTPè¯·æ±‚ï¼Œå°±è¢«TomcatæœåŠ¡å™¨å°è£…ä¸ºäº†ä¸€ä¸ªServletRequestå¯¹è±¡ï¼Œ
æˆ‘ä»¬å¾—åˆ°æ˜¯å…¶å®æ˜¯TomcatæœåŠ¡å™¨å¸®åŠ©æˆ‘ä»¬åˆ›å»ºçš„ä¸€ä¸ªå®ç°ç±»ï¼ŒHTTPè¯·æ±‚æŠ¥æ–‡ä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œ
éƒ½å¯ä»¥ä»ServletRequestå¯¹è±¡ä¸­è·å–ï¼ŒåŒç†ï¼ŒServletResponseå°±æ˜¯æˆ‘ä»¬éœ€è¦è¿”å›ç»™æµè§ˆå™¨çš„HTTPå“åº”æŠ¥æ–‡å®ä½“ç±»å°è£…ã€‚


## @WebServlet(value = "/test",loadOnStartup = 1) loadOnstartup å‚æ•°çš„ä½œç”¨ 

ä½ é—®çš„ `loadOnStartup = 1` æ˜¯ `@WebServlet` æ³¨è§£é‡Œéå¸¸å®ç”¨çš„é…ç½®é¡¹ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯**æ”¹å˜ Servlet çš„åˆå§‹åŒ–æ—¶æœº**ï¼Œæˆ‘ä¼šç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼å¸®ä½ è®²æ¸…æ¥šå®ƒçš„ä½œç”¨ã€ç”¨æ³•å’Œå®é™…ä»·å€¼ã€‚

### 1. å…ˆç†è§£ã€Œé»˜è®¤æƒ…å†µã€ï¼ˆä¸åŠ  loadOnStartupï¼‰
å¦‚æœä¸é…ç½®è¿™ä¸ªå‚æ•°ï¼ŒTomcat å¯åŠ¨æ—¶**ä¸ä¼šåˆå§‹åŒ–ä½ çš„ Servlet**ï¼Œè€Œæ˜¯è¦ç­‰ï¼š
- å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è®¿é—® `/test` è¿™ä¸ªè·¯å¾„æ—¶ï¼ŒTomcat æ‰ä¼šåˆ›å»º Servlet å®ä¾‹ â†’ æ‰§è¡Œ `init()` æ–¹æ³• â†’ å¤„ç†è¯·æ±‚ã€‚
- ç¼ºç‚¹ï¼šç¬¬ä¸€æ¬¡è®¿é—®ä¼šæœ‰æ˜æ˜¾å»¶è¿Ÿï¼ˆå› ä¸ºè¦åˆå§‹åŒ–ï¼‰ï¼Œå¦‚æœ Servlet çš„ `init()` é‡Œæœ‰è€—æ—¶æ“ä½œï¼ˆæ¯”å¦‚åŠ è½½é…ç½®ã€è¿æ¥æ•°æ®åº“ï¼‰ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚ä¼šå¾ˆæ…¢ç”šè‡³è¶…æ—¶ã€‚

### 2. loadOnStartup çš„æ ¸å¿ƒä½œç”¨
`loadOnStartup` æ˜¯ä¸€ä¸ª**æ•´æ•°å‚æ•°**ï¼Œå®ƒä¼šå‘Šè¯‰ Tomcatï¼š
> ã€Œå¯åŠ¨çš„æ—¶å€™å°±æŠŠè¿™ä¸ª Servlet åˆå§‹åŒ–å¥½ï¼Œä¸è¦ç­‰ç¬¬ä¸€æ¬¡è¯·æ±‚æ‰å¼„ï¼ã€

å…·ä½“è§„åˆ™ï¼š
- **å€¼ â‰¥ 0**ï¼šTomcat å¯åŠ¨æ—¶å°±åˆ›å»º Servlet å®ä¾‹ï¼Œæ‰§è¡Œ `init()` æ–¹æ³•ï¼ŒServlet è¿›å…¥ã€Œå°±ç»ªçŠ¶æ€ã€ï¼Œç­‰å¾…è¯·æ±‚ï¼›
- **å€¼ < 0**ï¼ˆé»˜è®¤ï¼Œä¸é…ç½®å°±æ˜¯ -1ï¼‰ï¼šæŒ‰é»˜è®¤è§„åˆ™ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶æ‰åˆå§‹åŒ–ï¼›
- **å¤šä¸ª Servlet æœ‰è¯¥å‚æ•°**ï¼šæ•°å€¼è¶Šå°ï¼Œåˆå§‹åŒ–ä¼˜å…ˆçº§è¶Šé«˜ï¼ˆæ¯”å¦‚ `loadOnStartup=1` æ¯” `=2` å…ˆåˆå§‹åŒ–ï¼‰ï¼›
- **å€¼ç›¸åŒ**ï¼šåˆå§‹åŒ–é¡ºåºç”± Tomcat å†³å®šï¼ˆä¸ä¿è¯ï¼‰ã€‚

### 3. ä»£ç ç¤ºä¾‹ + æ•ˆæœå¯¹æ¯”
#### ä½ çš„ä»£ç ï¼ˆåŠ äº† loadOnStartup = 1ï¼‰
```java
@WebServlet(value = "/test", loadOnStartup = 1)
public class TestServlet extends HttpServlet {
    @Override
    public void init() throws ServletException {
        // æ¨¡æ‹Ÿè€—æ—¶åˆå§‹åŒ–ï¼šåŠ è½½é…ç½®ã€è¿æ¥æ•°æ®åº“ç­‰
        System.out.println("TestServlet åˆå§‹åŒ–å®Œæˆï¼");
    }

    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        resp.getWriter().write("Hello Test!");
    }
}
```

#### æ•ˆæœï¼š
- å¯åŠ¨ Tomcat æ—¶ï¼Œæ§åˆ¶å°ç«‹åˆ»æ‰“å° `TestServlet åˆå§‹åŒ–å®Œæˆï¼`ï¼›
- ç¬¬ä¸€æ¬¡è®¿é—® `http://localhost:8080/xxx/test` æ—¶ï¼Œç›´æ¥è¿”å›ç»“æœï¼Œæ— åˆå§‹åŒ–å»¶è¿Ÿã€‚

#### ä¸åŠ  loadOnStartup çš„æ•ˆæœï¼š
- å¯åŠ¨ Tomcat æ—¶ï¼Œæ§åˆ¶å°æ— æ‰“å°ï¼›
- ç¬¬ä¸€æ¬¡è®¿é—® `/test` æ—¶ï¼Œå…ˆæ‰“å° `TestServlet åˆå§‹åŒ–å®Œæˆï¼`ï¼Œå†è¿”å›ç»“æœï¼ˆæœ‰å»¶è¿Ÿï¼‰ã€‚

### 4. å®é™…åº”ç”¨åœºæ™¯ï¼ˆä»€ä¹ˆæ—¶å€™ç”¨ï¼‰
- âœ… **Servlet åˆå§‹åŒ–æœ‰è€—æ—¶æ“ä½œ**ï¼šæ¯”å¦‚åŠ è½½é…ç½®æ–‡ä»¶ã€åˆå§‹åŒ–æ•°æ®åº“è¿æ¥æ± ã€é¢„åŠ è½½ç¼“å­˜ç­‰ï¼›
- âœ… **æ ¸å¿ƒä¸šåŠ¡ Servlet**ï¼šä¿è¯ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ä¸å¡é¡¿ï¼Œæå‡ä½“éªŒï¼›
- âŒ éæ ¸å¿ƒ/æå°‘è®¿é—®çš„ Servletï¼šæ²¡å¿…è¦æå‰åˆå§‹åŒ–ï¼Œæµªè´¹å†…å­˜ã€‚

### æ€»ç»“
1. `loadOnStartup = 1` è®© Servlet åœ¨**Tomcat å¯åŠ¨æ—¶å°±å®Œæˆåˆå§‹åŒ–**ï¼Œè€Œéç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ï¼›
2. æ•°å€¼ â‰¥ 0 ç”Ÿæ•ˆï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè§£å†³ã€Œç¬¬ä¸€æ¬¡è®¿é—®å¡é¡¿ã€é—®é¢˜ï¼›
3. é€‚åˆåˆå§‹åŒ–æœ‰è€—æ—¶æ“ä½œçš„æ ¸å¿ƒ Servletï¼Œéæ ¸å¿ƒ Servlet æ— éœ€é…ç½®ï¼ˆç”¨é»˜è®¤ -1 å³å¯ï¼‰ã€‚

ç®€å•è®°ï¼š`loadOnStartup` å°±æ˜¯ã€Œå¯åŠ¨æ—¶åŠ è½½ã€ï¼Œæ•°å€¼æ˜¯ä¼˜å…ˆçº§ï¼Œæ ¸å¿ƒ Servlet é… 1/2 å³å¯ã€‚


## ä¸Šä¼ æ–‡ä»¶çš„è·¯å¾„ä¸ºä»€ä¹ˆä¸èƒ½æ˜¯æ–‡ä»¶å¤¹

ä½ ç°åœ¨é‡åˆ°çš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼šæŠŠæ–‡ä»¶ä¸Šä¼ çš„ç›®æ ‡è·¯å¾„è®¾æˆäº†**æ–‡ä»¶å¤¹**ï¼ˆ`/Users/xuyaochen/FuRiIT/project/WebTest/src/main/resources`ï¼‰ï¼Œä½† `FileOutputStream` è¦æ±‚å¿…é¡»æŒ‡å®š**å…·ä½“çš„æ–‡ä»¶åç§°**ï¼Œè€Œä¸æ˜¯æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æŠ›å‡ºäº† `FileNotFoundException` å¼‚å¸¸ã€‚

### ä¸ºä»€ä¹ˆè·¯å¾„ä¸èƒ½æ˜¯æ–‡ä»¶å¤¹ï¼Ÿ
`FileOutputStream` çš„æ ¸å¿ƒä½œç”¨æ˜¯**å†™å…¥ã€Œæ–‡ä»¶ã€**ï¼Œè€Œä¸æ˜¯ã€Œæ–‡ä»¶å¤¹ã€ï¼š
- å½“ä½ ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶å¤¹è·¯å¾„æ—¶ï¼ŒJVM ä¼šè®¤ä¸ºä½ è¦æŠŠæ•°æ®ç›´æ¥å†™å…¥è¿™ä¸ªæ–‡ä»¶å¤¹ï¼ˆè€Œéæ–‡ä»¶å¤¹é‡Œçš„æŸä¸ªæ–‡ä»¶ï¼‰ï¼Œä½†æ–‡ä»¶å¤¹æœ¬èº«æ˜¯ã€Œå®¹å™¨ã€ï¼Œä¸æ˜¯å¯å†™å…¥çš„æ–‡ä»¶ï¼Œå› æ­¤ç³»ç»Ÿä¼šæŠ¥é”™ã€ŒIs a directoryã€ï¼ˆæ˜¯ä¸€ä¸ªç›®å½•ï¼‰ã€‚
- ä¸¾ä¸ªé€šä¿—çš„ä¾‹å­ï¼šä½ æƒ³æŠŠæ–‡ä»¶æ”¾åˆ°æŠ½å±‰é‡Œï¼ˆæ–‡ä»¶å¤¹ï¼‰ï¼Œä½†å¿…é¡»æŒ‡å®šã€Œæ”¾åˆ°æŠ½å±‰é‡Œçš„æŸå¼ çº¸ã€ï¼ˆå…·ä½“æ–‡ä»¶ï¼‰ï¼Œè€Œä¸èƒ½ç›´æ¥æŠŠå†…å®¹å†™åœ¨æŠ½å±‰æœ¬èº«ä¸Šã€‚

### ä¿®å¤ä»£ç ï¼ˆæ ¸å¿ƒï¼šæ‹¼æ¥ã€Œæ–‡ä»¶å¤¹+å…·ä½“æ–‡ä»¶åã€ï¼‰
æˆ‘å¸®ä½ ä¿®æ”¹ä»£ç ï¼Œæ—¢æŒ‡å®šæ–‡ä»¶å¤¹è·¯å¾„ï¼Œåˆè‡ªåŠ¨è·å–ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹åç§°ï¼Œç¡®ä¿å†™å…¥åˆ°å…·ä½“æ–‡ä»¶ä¸­ï¼š
```java
protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    // 1. è§£å†³ä¸­æ–‡ä¹±ç 
    req.setCharacterEncoding("UTF-8");
    resp.setContentType("text/html;charset=UTF-8");

    // 2. å®šä¹‰æ–‡ä»¶ä¿å­˜çš„ã€Œæ–‡ä»¶å¤¹è·¯å¾„ã€ï¼ˆç¡®ä¿è¿™ä¸ªæ–‡ä»¶å¤¹å·²å­˜åœ¨ï¼ï¼‰
    String saveDir = "/Users/xuyaochen/FuRiIT/project/WebTest/src/main/resources/";
    // æ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
    File dir = new File(saveDir);
    if (!dir.exists()) {
        dir.mkdirs(); // é€’å½’åˆ›å»ºå¤šçº§æ–‡ä»¶å¤¹
    }

    try {
        // 3. è·å–ä¸Šä¼ çš„æ–‡ä»¶éƒ¨ä»¶ï¼ˆå¯¹åº”å‰ç«¯inputçš„name="test-file"ï¼‰
        Part part = req.getPart("test-file");
        // 4. è·å–ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹åç§°ï¼ˆæ¯”å¦‚ "test.png"ï¼‰
        String fileName = part.getSubmittedFileName();
        // é˜²æ­¢ç©ºæ–‡ä»¶åï¼ˆæ¯”å¦‚ç”¨æˆ·æ²¡é€‰æ–‡ä»¶å°±æäº¤ï¼‰
        if (fileName == null || fileName.isEmpty()) {
            resp.getWriter().write("è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼");
            return;
        }

        // 5. æ‹¼æ¥ã€Œæ–‡ä»¶å¤¹è·¯å¾„ + æ–‡ä»¶åã€ï¼Œå¾—åˆ°å®Œæ•´çš„æ–‡ä»¶è·¯å¾„ï¼ˆå…³é”®ï¼ï¼‰
        String fullFilePath = saveDir + fileName;
        // 6. å†™å…¥åˆ°å…·ä½“æ–‡ä»¶ï¼ˆè€Œéæ–‡ä»¶å¤¹ï¼‰
        try (FileOutputStream stream = new FileOutputStream(fullFilePath)) {
            IOUtils.copy(part.getInputStream(), stream);
            resp.getWriter().write("æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼ä¿å­˜è·¯å¾„ï¼š" + fullFilePath);
        }
    } catch (Exception e) {
        resp.getWriter().write("æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage());
        e.printStackTrace();
    }
}
```

### å…³é”®è¡¥å……è¯´æ˜
1. **å¿…é¡»ç¡®ä¿æ–‡ä»¶å¤¹å­˜åœ¨**ï¼š
   å¦‚æœ `src/main/resources` æ–‡ä»¶å¤¹ä¸å­˜åœ¨ï¼Œ`FileOutputStream` ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥ä»£ç ä¸­åŠ äº† `dir.mkdirs()` è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆ`mkdirs()` æ”¯æŒåˆ›å»ºå¤šçº§æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ `a/b/c`ï¼Œè€Œ `mkdir()` åªèƒ½åˆ›å»ºå•çº§ï¼‰ã€‚

2. **é¿å…æ–‡ä»¶è¦†ç›–**ï¼ˆå¯é€‰ä½†æ¨èï¼‰ï¼š
   å¦‚æœå¤šä¸ªç”¨æˆ·ä¸Šä¼ åŒåæ–‡ä»¶ï¼ˆæ¯”å¦‚éƒ½å« `test.png`ï¼‰ï¼Œåä¸Šä¼ çš„ä¼šè¦†ç›–å…ˆä¸Šä¼ çš„ã€‚å¯ä»¥ç»™æ–‡ä»¶ååŠ å”¯ä¸€æ ‡è¯†ï¼ˆæ¯”å¦‚ UUIDï¼‰ï¼š
   ```java
   // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼šUUID + åŸå§‹æ–‡ä»¶åï¼ˆé¿å…è¦†ç›–ï¼‰
   String uniqueFileName = UUID.randomUUID().toString() + "_" + fileName;
   String fullFilePath = saveDir + uniqueFileName;
   ```

3. **ä¸ºä»€ä¹ˆä¸å»ºè®®ä¸Šä¼ åˆ° resources æ–‡ä»¶å¤¹ï¼Ÿ**
   `src/main/resources` æ˜¯é¡¹ç›®çš„ã€Œèµ„æºæºç ç›®å½•ã€ï¼Œè¿è¡Œæ—¶ä¼šè¢«æ‰“åŒ…åˆ° WAR/JAR ä¸­ï¼Œ**ä¸é€‚åˆä½œä¸ºæ–‡ä»¶ä¸Šä¼ çš„ç›®æ ‡è·¯å¾„**ï¼š
    - éƒ¨ç½²åˆ° Tomcat åï¼Œè¿™ä¸ªè·¯å¾„å¯èƒ½æ˜¯åªè¯»çš„ï¼ˆæ— æ³•å†™å…¥ï¼‰ï¼›
    - é‡æ–°ç¼–è¯‘/æ‰“åŒ…é¡¹ç›®æ—¶ï¼Œä¸Šä¼ çš„æ–‡ä»¶ä¼šè¢«æ¸…ç©ºã€‚
      æ¨èåšæ³•ï¼šé€‰æ‹©é¡¹ç›®å¤–çš„ç‹¬ç«‹æ–‡ä»¶å¤¹ï¼ˆæ¯”å¦‚ `/Users/xuyaochen/upload/`ï¼‰ï¼Œæˆ– Tomcat çš„ä¸´æ—¶ç›®å½•ã€‚

### æ€»ç»“
1. `FileOutputStream` å¿…é¡»æŒ‡å®š**å…·ä½“æ–‡ä»¶åç§°**ï¼Œä¸èƒ½æ˜¯æ–‡ä»¶å¤¹è·¯å¾„ï¼Œå› ä¸ºå®ƒçš„ä½œç”¨æ˜¯å†™å…¥ã€Œæ–‡ä»¶ã€è€Œéã€Œç›®å½•ã€ï¼›
2. ä¿®å¤æ ¸å¿ƒï¼šæ‹¼æ¥ã€Œæ–‡ä»¶å¤¹è·¯å¾„ + ä¸Šä¼ æ–‡ä»¶çš„åŸå§‹åç§°ã€ï¼Œç”Ÿæˆå®Œæ•´çš„æ–‡ä»¶è·¯å¾„ï¼›
3. é¢å¤–ä¼˜åŒ–ï¼šæ£€æŸ¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ã€å¤„ç†ç©ºæ–‡ä»¶åã€é¿å…æ–‡ä»¶è¦†ç›–ï¼Œä¸”ä¸è¦ä¸Šä¼ åˆ° `resources` æºç ç›®å½•ã€‚

æŒ‰è¿™ä¸ªä»£ç ä¿®æ”¹åï¼Œå°±èƒ½æ­£å¸¸ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹é‡Œçš„å…·ä½“æ–‡ä»¶äº†ã€‚å¦‚æœè¿˜æŠ¥é”™ï¼Œå¤§æ¦‚ç‡æ˜¯æ–‡ä»¶å¤¹æƒé™é—®é¢˜ï¼ˆæ¯”å¦‚æ²¡æœ‰å†™å…¥æƒé™ï¼‰ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæˆ‘å†å¸®ä½ è§£å†³~


## filterChain.doFilter

### ä¸€ã€æ ¸å¿ƒéœ€æ±‚ç†è§£
ä½ æƒ³æ·±å…¥äº†è§£ `filterChain.doFilter()` è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨ã€ä½¿ç”¨åœºæ™¯å’Œå·¥ä½œåŸç†ï¼Œæˆ‘ä¼šä»åŸºç¡€æ¦‚å¿µåˆ°å®é™…åº”ç”¨ï¼Œç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼å¸®ä½ æŠŠè¿™ä¸ªçŸ¥è¯†ç‚¹è®²é€ï¼Œç»“åˆä½ ç†Ÿæ‚‰çš„Servletç™»å½•åœºæ™¯æ¥ä¸¾ä¾‹ï¼Œè®©ä½ æ›´å®¹æ˜“ç†è§£ã€‚

### äºŒã€`filterChain.doFilter()` å®Œæ•´ç§‘æ™®
#### 1. å…ˆææ‡‚ï¼šFilterï¼ˆè¿‡æ»¤å™¨ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ
åœ¨Servletä½“ç³»ä¸­ï¼ŒFilteræ˜¯**æ‹¦æˆªè¯·æ±‚/å“åº”çš„ä¸­é—´ä»¶**ï¼Œå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾Servletä¹‹å‰ã€å“åº”è¿”å›æµè§ˆå™¨ä¹‹å‰åšç»Ÿä¸€å¤„ç†ï¼ˆæ¯”å¦‚ç™»å½•æ ¡éªŒã€ç¼–ç ç»Ÿä¸€ã€æ—¥å¿—è®°å½•ï¼‰ã€‚
ä½ å¯ä»¥æŠŠFilterç†è§£æˆï¼šç”¨æˆ·ï¼ˆæµè§ˆå™¨ï¼‰å»è®¿é—®Servletï¼ˆå…¬å¸åŠå…¬å®¤ï¼‰ï¼Œå¿…é¡»å…ˆç»è¿‡Filterï¼ˆå…¬å¸é—¨å«ï¼‰ï¼Œé—¨å«å¯ä»¥å†³å®šâ€œæ”¾è¡Œâ€â€œæ‹’ç»â€æˆ–â€œå…ˆå¤„ç†å†æ”¾è¡Œâ€ã€‚

#### 2. `FilterChain`ï¼ˆè¿‡æ»¤å™¨é“¾ï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ
ä¸€ä¸ªWebåº”ç”¨ä¸­å¯ä»¥é…ç½®**å¤šä¸ªFilter**ï¼ˆæ¯”å¦‚ä¸€ä¸ªåšç™»å½•æ ¡éªŒã€ä¸€ä¸ªåšç¼–ç å¤„ç†ã€ä¸€ä¸ªåšæ—¥å¿—è®°å½•ï¼‰ï¼Œè¿™äº›Filterä¼šæŒ‰é…ç½®é¡ºåºç»„æˆä¸€ä¸ªâ€œé“¾æ¡â€ï¼Œè¿™å°±æ˜¯ `FilterChain`ï¼ˆè¿‡æ»¤å™¨é“¾ï¼‰ã€‚

#### 3. `filterChain.doFilter()` æ ¸å¿ƒä½œç”¨
`filterChain.doFilter(request, response)` æ˜¯è¿‡æ»¤å™¨é“¾çš„**æ ¸å¿ƒæ”¾è¡Œæ–¹æ³•**ï¼Œä½œç”¨æ˜¯ï¼š
- æŠŠå½“å‰è¯·æ±‚/å“åº”ä¼ é€’ç»™**è¿‡æ»¤å™¨é“¾ä¸­çš„ä¸‹ä¸€ä¸ªFilter**ï¼›
- å¦‚æœå½“å‰Filteræ˜¯é“¾æ¡æœ€åä¸€ä¸ªï¼Œåˆ™ä¼ é€’ç»™**ç›®æ ‡Servlet**ï¼ˆæ¯”å¦‚ä½ çš„LoginServletï¼‰ã€‚

ç®€å•è¯´ï¼š`doFilter()` å°±æ˜¯â€œæ”¾è¡Œâ€æŒ‰é’®ï¼Œè°ƒç”¨å®ƒï¼Œè¯·æ±‚æ‰ä¼šç»§ç»­å¾€ä¸‹èµ°ï¼›ä¸è°ƒç”¨ï¼Œè¯·æ±‚å°±ä¼šè¢«æ‹¦æˆªåœ¨å½“å‰Filterã€‚

#### 4. å·¥ä½œæµç¨‹ï¼ˆç»“åˆä½ çš„ç™»å½•åœºæ™¯ä¸¾ä¾‹ï¼‰
å‡è®¾ä½ é…ç½®äº†ä¸¤ä¸ªFilterï¼š`LoginFilter`ï¼ˆç™»å½•æ ¡éªŒï¼‰ + `EncodingFilter`ï¼ˆç¼–ç ç»Ÿä¸€ï¼‰ï¼Œå†åŠ ä¸Šç›®æ ‡`LoginServlet`ï¼Œå®Œæ•´æµç¨‹å¦‚ä¸‹ï¼š
```mermaid
graph TD
    A[æµè§ˆå™¨å‘é€è¯·æ±‚ /login] --> B[EncodingFilter]
    B --> C{æ˜¯å¦è°ƒç”¨doFilter?}
    C -- æ˜¯ --> D[LoginFilter]
    C -- å¦ --> E[ç›´æ¥è¿”å›å“åº”ï¼ˆæ‹¦æˆªï¼‰]
    D --> F{æ˜¯å¦è°ƒç”¨doFilter?}
    F -- æ˜¯ --> G[LoginServlet]
    F -- å¦ --> H[ç›´æ¥è¿”å›å“åº”ï¼ˆæ¯”å¦‚æœªç™»å½•æç¤ºï¼‰]
    G --> I[å¤„ç†è¯·æ±‚ï¼ˆdoGet/doPostï¼‰]
    I --> J[è¿”å›å“åº”]
    J --> D[LoginFilterï¼ˆå“åº”é˜¶æ®µå¤„ç†ï¼‰]
    D --> B[EncodingFilterï¼ˆå“åº”é˜¶æ®µå¤„ç†ï¼‰]
    B --> K[æµè§ˆå™¨æ¥æ”¶å“åº”]
```

##### ä»£ç ç¤ºä¾‹ï¼ˆæœ€æ˜“ç†è§£çš„LoginFilterï¼‰
ç»“åˆä½ ä¹‹å‰çš„ç™»å½•åœºæ™¯ï¼Œå†™ä¸€ä¸ªå®ç”¨çš„`LoginFilter`ï¼Œä½ èƒ½ç›´è§‚çœ‹åˆ°`doFilter()`çš„ç”¨æ³•ï¼š
```java
package org.example.filter;

import jakarta.servlet.*;
import jakarta.servlet.annotation.WebFilter;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import jakarta.servlet.http.HttpSession;
import org.example.entity.Users;

import java.io.IOException;

// æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼ˆ/*ï¼‰ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šæ‹¦æˆªç‰¹å®šè·¯å¾„ï¼ˆ/timeï¼‰
@WebFilter("/*")
public class LoginFilter implements Filter {

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        // å¼ºè½¬ä¸ºHttpServletRequestï¼Œæ–¹ä¾¿è·å–Sessionã€è·¯å¾„ç­‰
        HttpServletRequest req = (HttpServletRequest) servletRequest;
        HttpServletResponse resp = (HttpServletResponse) servletResponse;

        // 1. æ’é™¤ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼ˆæ¯”å¦‚ç™»å½•é¡µã€é™æ€èµ„æºï¼‰
        String url = req.getRequestURI();
        if (url.contains("/login")) {
            // è®¿é—®ç™»å½•é¡µï¼Œç›´æ¥æ”¾è¡Œï¼Œè°ƒç”¨doFilterè®©è¯·æ±‚åˆ°LoginServlet
            filterChain.doFilter(req, resp);
            return; // æ”¾è¡Œåç»ˆæ­¢å½“å‰Filteré€»è¾‘
        }

        // 2. æ ¡éªŒSessionä¸­çš„ç”¨æˆ·æ˜¯å¦ç™»å½•
        HttpSession session = req.getSession();
        Users user = (Users) session.getAttribute("user");
        if (user != null) {
            // å·²ç™»å½•ï¼Œæ”¾è¡Œåˆ°ç›®æ ‡èµ„æºï¼ˆæ¯”å¦‚/timeï¼‰
            filterChain.doFilter(req, resp);
        } else {
            // æœªç™»å½•ï¼Œæ‹¦æˆªå¹¶è·³è½¬åˆ°ç™»å½•é¡µï¼ˆä¸è°ƒç”¨doFilterï¼‰
            resp.sendRedirect("login");
        }
    }
}
```

#### 5. å…³é”®ç»†èŠ‚ï¼ˆæ–°æ‰‹å¿…çœ‹ï¼‰
##### ï¼ˆ1ï¼‰`doFilter()` çš„ä¸¤ä¸ªå‚æ•°
`filterChain.doFilter(ServletRequest request, ServletResponse response)` çš„å‚æ•°ï¼š
- å¯ä»¥ç›´æ¥ä¼ é€’åŸå§‹çš„`request/response`ï¼›
- ä¹Ÿå¯ä»¥ä¼ é€’**åŒ…è£…åçš„è¯·æ±‚/å“åº”**ï¼ˆæ¯”å¦‚è‡ªå®šä¹‰`HttpServletRequestWrapper`ï¼Œå®ç°å‚æ•°ä¿®æ”¹ã€è¯·æ±‚ä½“è¯»å–ç­‰ï¼‰ã€‚

##### ï¼ˆ2ï¼‰ä¸è°ƒç”¨`doFilter()` = æ‹¦æˆªè¯·æ±‚
å¦‚æœåœ¨Filterä¸­ä¸è°ƒç”¨`filterChain.doFilter()`ï¼Œè¯·æ±‚å°±ä¼šè¢«â€œå¡ä½â€ï¼Œä¸ä¼šåˆ°è¾¾åç»­Filteræˆ–Servletã€‚
âœ… å…¸å‹åœºæ™¯ï¼šæœªç™»å½•æ—¶ï¼Œç›´æ¥`resp.sendRedirect("login")`ï¼Œä¸è°ƒç”¨`doFilter()`ï¼Œæ‹¦æˆªè¯·æ±‚ã€‚

##### ï¼ˆ3ï¼‰Filterçš„æ‰§è¡Œé¡ºåº
- æ³¨è§£æ–¹å¼ï¼ˆ`@WebFilter`ï¼‰ï¼šæŒ‰Filterç±»åçš„å­—æ¯é¡ºåºæ‰§è¡Œï¼ˆæ¯”å¦‚`ALoginFilter`å…ˆäº`BEncodingFilter`ï¼‰ï¼›
- XMLé…ç½®æ–¹å¼ï¼ˆ`web.xml`ï¼‰ï¼šæŒ‰`<filter-mapping>`çš„é¡ºåºæ‰§è¡Œï¼ˆæ›´çµæ´»ï¼‰ã€‚

##### ï¼ˆ4ï¼‰å“åº”é˜¶æ®µä¹Ÿä¼šæ‰§è¡ŒFilter
Filterä¸ä»…åœ¨â€œè¯·æ±‚åˆ°è¾¾Servletå‰â€æ‰§è¡Œï¼Œåœ¨â€œServletè¿”å›å“åº”åâ€ä¹Ÿä¼šæ‰§è¡Œï¼ˆ`doFilter()`ä¹‹åçš„ä»£ç ï¼‰ï¼š
```java
@Override
public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException, ServletException {
    // 1. è¯·æ±‚é˜¶æ®µï¼šåœ¨æ”¾è¡Œå‰æ‰§è¡Œï¼ˆæ¯”å¦‚è®°å½•è¯·æ±‚å¼€å§‹æ—¶é—´ï¼‰
    long start = System.currentTimeMillis();
    
    // æ”¾è¡Œåˆ°ä¸‹ä¸€ä¸ªFilter/Servlet
    chain.doFilter(req, resp);
    
    // 2. å“åº”é˜¶æ®µï¼šåœ¨Servletè¿”å›å“åº”åæ‰§è¡Œï¼ˆæ¯”å¦‚è®°å½•è¯·æ±‚è€—æ—¶ï¼‰
    long end = System.currentTimeMillis();
    System.out.println("è¯·æ±‚è€—æ—¶ï¼š" + (end - start) + "ms");
}
```

### ä¸‰ã€æ€»ç»“
1. `filterChain.doFilter()` æ˜¯Filterçš„æ ¸å¿ƒæ”¾è¡Œæ–¹æ³•ï¼Œè°ƒç”¨å®ƒè¯·æ±‚æ‰ä¼šä¼ é€’åˆ°ä¸‹ä¸€ä¸ªFilter/Servletï¼Œä¸è°ƒç”¨åˆ™æ‹¦æˆªè¯·æ±‚ï¼›
2. Filteræ˜¯Servletçš„å‰ç½®/åç½®å¤„ç†å™¨ï¼Œå¸¸ç”¨äºç™»å½•æ ¡éªŒã€ç¼–ç ç»Ÿä¸€ã€æ—¥å¿—è®°å½•ç­‰ç»Ÿä¸€é€»è¾‘ï¼›
3. ç»“åˆä½ çš„ç™»å½•åœºæ™¯ï¼šå¯ä»¥ç”¨Filteræ‹¦æˆª`/time`ç­‰éœ€è¦ç™»å½•çš„è·¯å¾„ï¼Œæœªç™»å½•æ—¶ä¸è°ƒç”¨`doFilter()`ï¼Œç›´æ¥è·³ç™»å½•é¡µï¼Œæ¯”åœ¨Servletä¸­å†™æ ¡éªŒé€»è¾‘æ›´ä¼˜é›…ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰ã€‚

ç®€å•è®°ï¼š`doFilter()` = æ”¾è¡Œï¼Œä¸è°ƒ = æ‹¦æˆªï¼Œè¿™æ˜¯Filteræœ€æ ¸å¿ƒçš„ç”¨æ³•ã€‚


## æµè§ˆå™¨åœ¨ä½•æ—¶ä¼šè¯·æ±‚ js/css/å›¾ç‰‡ç­‰èµ„æº

### ä¸€ã€æ ¸å¿ƒéœ€æ±‚ç†è§£
ä½ æƒ³çŸ¥é“æµè§ˆå™¨å…·ä½“åœ¨ä»€ä¹ˆæ—¶å€™è¯·æ±‚JSã€CSSã€PNGè¿™ç±»é™æ€èµ„æºï¼Œä»¥åŠä½ çš„Filterä»£ç ä¸­æ’é™¤è¿™äº›é™æ€èµ„æºçš„åˆ¤æ–­é€»è¾‘æ˜¯å¦çœŸçš„æœ‰å¿…è¦ï¼ˆä¹Ÿå°±æ˜¯æµè§ˆå™¨æ˜¯å¦çœŸçš„ä¼šå•ç‹¬è¯·æ±‚è¿™äº›èµ„æºï¼‰ã€‚

### äºŒã€è¯¦ç»†è§£ç­”
#### 1. æµè§ˆå™¨è¯·æ±‚é™æ€èµ„æºçš„æ—¶æœºï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰
æµè§ˆå™¨**ä¸€å®šä¼šå•ç‹¬è¯·æ±‚JS/CSS/PNGç­‰é™æ€èµ„æº**ï¼Œè¯·æ±‚æ—¶æœºåˆ†ä¸¤æ­¥ï¼š
##### æ­¥éª¤1ï¼šå…ˆè¯·æ±‚HTMLé¡µé¢ï¼ˆè§¦å‘ä½ çš„Filteræ‹¦æˆªï¼‰
å½“ä½ è®¿é—®`http://localhost:8080/é¡¹ç›®å/index.html`ï¼ˆæˆ–è½¬å‘åˆ°`/`çš„é¦–é¡µï¼‰æ—¶ï¼Œæµè§ˆå™¨ä¼šå…ˆå‘é€**GETè¯·æ±‚**è·å–HTMLé¡µé¢çš„å†…å®¹ï¼ˆè¿™ä¸€æ­¥ä¼šè¢«ä½ çš„`@WebFilter("/*")`æ‹¦æˆªï¼‰ã€‚

##### æ­¥éª¤2ï¼šè§£æHTMLæ—¶ï¼Œè‡ªåŠ¨å‘èµ·é™æ€èµ„æºè¯·æ±‚
æµè§ˆå™¨æ‹¿åˆ°HTMLå†…å®¹åï¼Œä¼šé€è¡Œè§£ææ ‡ç­¾ï¼Œé‡åˆ°`<script>`ã€`<link>`ã€`<img>`ç­‰å¼•ç”¨é™æ€èµ„æºçš„æ ‡ç­¾æ—¶ï¼Œ**ç«‹åˆ»å‘èµ·æ–°çš„GETè¯·æ±‚**è·å–å¯¹åº”èµ„æºï¼š
```html
<!-- è§£æåˆ°è¿™è¡Œï¼Œæµè§ˆå™¨ä¼šå‘ GET /js/index.js è¯·æ±‚ -->
<script src="/js/index.js"></script>

<!-- è§£æåˆ°è¿™è¡Œï¼Œæµè§ˆå™¨ä¼šå‘ GET /css/style.css è¯·æ±‚ -->
<link rel="stylesheet" href="/css/style.css">

<!-- è§£æåˆ°è¿™è¡Œï¼Œæµè§ˆå™¨ä¼šå‘ GET /img/logo.png è¯·æ±‚ -->
<img src="/img/logo.png" alt="logo">
```

ä¸¾ä¸ªç›´è§‚çš„ä¾‹å­ï¼š
ä½ æ‰“å¼€æµè§ˆå™¨F12çš„`Network`æ ‡ç­¾ï¼Œè®¿é—®é¦–é¡µåä¼šçœ‹åˆ°ï¼š
- ç¬¬1ä¸ªè¯·æ±‚ï¼š`GET /`ï¼ˆè·å–HTMLï¼‰
- ç¬¬2ä¸ªè¯·æ±‚ï¼š`GET /js/index.js`ï¼ˆè·å–JSï¼‰
- ç¬¬3ä¸ªè¯·æ±‚ï¼š`GET /css/style.css`ï¼ˆè·å–CSSï¼‰
- ç¬¬4ä¸ªè¯·æ±‚ï¼š`GET /img/logo.png`ï¼ˆè·å–å›¾ç‰‡ï¼‰

è¿™äº›é™æ€èµ„æºè¯·æ±‚**éƒ½ä¼šè¢«ä½ çš„`@WebFilter("/*")`æ‹¦æˆª**â€”â€”å¦‚æœä½ çš„Filterä¸æ’é™¤è¿™äº›è¯·æ±‚ï¼Œå°±ä¼šè§¦å‘ç™»å½•æ ¡éªŒï¼Œå¯¼è‡´é™æ€èµ„æºåŠ è½½å¤±è´¥ï¼ˆå› ä¸ºé™æ€èµ„æºè¯·æ±‚çš„Sessionä¸­æ²¡æœ‰`user`ï¼Œä¼šè¢«é‡å®šå‘åˆ°loginé¡µï¼‰ã€‚

#### 2. ä½ çš„Filterä»£ç ä¸ºä»€ä¹ˆè¦æ’é™¤é™æ€èµ„æºï¼Ÿï¼ˆå…³é”®é€»è¾‘ï¼‰
ä½ çš„ä»£ç ä¸­`if(!url.endsWith(".js") && !url.endsWith(".css") && !url.endsWith(".png"))`è¿™è¡Œåˆ¤æ–­**éå¸¸å¿…è¦**ï¼Œä¸æ’é™¤ä¼šå‡ºå¤§é—®é¢˜ï¼š
##### é—®é¢˜åœºæ™¯ï¼ˆä¸æ’é™¤é™æ€èµ„æºçš„åæœï¼‰ï¼š
1. æµè§ˆå™¨è¯·æ±‚`/js/index.js` â†’ è¢«Filteræ‹¦æˆªï¼›
2. Filteræ£€æŸ¥Sessionï¼š`user == null`ï¼ˆé™æ€èµ„æºè¯·æ±‚ä¸ä¼šå¸¦ç™»å½•æ€ï¼‰ï¼Œä¸”URLä¸æ˜¯`login` â†’ æ‰§è¡Œ`res.sendRedirect("login")`ï¼›
3. æµè§ˆå™¨æœ¬æƒ³åŠ è½½JSæ–‡ä»¶ï¼Œå´æ”¶åˆ°é‡å®šå‘å“åº”ï¼Œæœ€ç»ˆæ‹¿åˆ°çš„æ˜¯loginé¡µé¢çš„HTMLï¼Œè€ŒéJSä»£ç ï¼›
4. é¡µé¢è¡¨ç°ï¼šHTMLèƒ½æ˜¾ç¤ºï¼Œä½†JS/CSS/å›¾ç‰‡åŠ è½½å¤±è´¥ â†’ é¡µé¢æ ·å¼é”™ä¹±ã€äº¤äº’åŠŸèƒ½å¤±æ•ˆã€‚

##### ä½ çš„ä»£ç é€»è¾‘éªŒè¯ï¼ˆæ­£ç¡®ä¸”å®ç”¨ï¼‰ï¼š
```java
// åªæœ‰ã€ä¸æ˜¯é™æ€èµ„æºã€‘çš„è¯·æ±‚ï¼Œæ‰åšç™»å½•æ ¡éªŒ
if(!url.endsWith(".js") && !url.endsWith(".css") && !url.endsWith(".png")){
    // ç™»å½•æ ¡éªŒé€»è¾‘ï¼šæœªç™»å½•ä¸”ä¸æ˜¯è®¿é—®loginé¡µ â†’ é‡å®šå‘åˆ°login
}
// é™æ€èµ„æºè¯·æ±‚ç›´æ¥æ”¾è¡Œï¼ˆæ‰§è¡Œchain.doFilterï¼‰
```

#### 3. è¡¥å……ï¼šé™æ€èµ„æºè¯·æ±‚çš„ç»†èŠ‚ï¼ˆæ–°æ‰‹æ˜“å¿½ç•¥ï¼‰
##### ï¼ˆ1ï¼‰é™æ€èµ„æºè¯·æ±‚çš„ç‰¹å¾
- éƒ½æ˜¯**GETè¯·æ±‚**ï¼ˆæµè§ˆå™¨è·å–é™æ€èµ„æºé»˜è®¤ç”¨GETï¼‰ï¼›
- è¯·æ±‚URLä»¥é™æ€èµ„æºåç¼€ç»“å°¾ï¼ˆ.js/.css/.png/.jpg/.icoç­‰ï¼‰ï¼›
- è¿™ç±»è¯·æ±‚ä¸éœ€è¦ç™»å½•æ€ï¼Œå¿…é¡»æ”¾è¡Œï¼Œå¦åˆ™é¡µé¢ä¼šâ€œè£¸å¥”â€ï¼ˆæ— æ ·å¼ã€æ— äº¤äº’ï¼‰ã€‚

##### ï¼ˆ2ï¼‰ä½ çš„ä»£ç å¯ä»¥ä¼˜åŒ–çš„ç‚¹
å½“å‰åˆ¤æ–­åªæ’é™¤äº†`.js/.css/.png`ï¼Œå®é™…å¼€å‘ä¸­å»ºè®®è¡¥å……æ›´å¤šé™æ€èµ„æºåç¼€ï¼Œé¿å…é—æ¼ï¼š
```java
// ä¼˜åŒ–ï¼šç”¨é›†åˆå­˜å‚¨æ‰€æœ‰é™æ€èµ„æºåç¼€ï¼Œæ›´æ˜“ç»´æŠ¤
Set<String> staticSuffix = new HashSet<>(Arrays.asList(".js", ".css", ".png", ".jpg", ".jpeg", ".gif", ".ico", ".html", ".htm"));
// è·å–è¯·æ±‚URLçš„åç¼€
String suffix = url.substring(url.lastIndexOf("."));
// åˆ¤æ–­æ˜¯å¦ä¸ºé™æ€èµ„æº
if(!staticSuffix.contains(suffix)){
    // ç™»å½•æ ¡éªŒé€»è¾‘...
}
```

##### ï¼ˆ3ï¼‰å¦‚ä½•éªŒè¯é™æ€èµ„æºè¯·æ±‚è¢«æ‹¦æˆªï¼Ÿ
æ‰“å¼€æµè§ˆå™¨F12 â†’ `Network`æ ‡ç­¾ â†’ åˆ·æ–°é¡µé¢ï¼š
- å¦‚æœJS/CSSçš„è¯·æ±‚çŠ¶æ€æ˜¯`302`ï¼ˆé‡å®šå‘ï¼‰ï¼Œä¸”å“åº”å†…å®¹æ˜¯loginé¡µé¢ â†’ è¯´æ˜Filteræ‹¦æˆªäº†é™æ€èµ„æºï¼ˆä½ çš„æ’é™¤é€»è¾‘æ²¡ç”Ÿæ•ˆï¼‰ï¼›
- å¦‚æœJS/CSSçš„è¯·æ±‚çŠ¶æ€æ˜¯`200` â†’ è¯´æ˜æ’é™¤é€»è¾‘ç”Ÿæ•ˆï¼Œé™æ€èµ„æºæ­£å¸¸åŠ è½½ã€‚

### ä¸‰ã€æ€»ç»“
1. æµè§ˆå™¨è¯·æ±‚é™æ€èµ„æºçš„æ—¶æœºï¼šå…ˆè¯·æ±‚HTMLé¡µé¢ï¼Œè§£æHTMLæ—¶ä¼šè‡ªåŠ¨å‘èµ·ç‹¬ç«‹çš„GETè¯·æ±‚è·å–JS/CSS/PNGç­‰é™æ€èµ„æºï¼›
2. ä½ çš„Filterå¿…é¡»æ’é™¤é™æ€èµ„æºï¼šå¦åˆ™è¿™äº›è¯·æ±‚ä¼šè¢«ç™»å½•æ ¡éªŒæ‹¦æˆªï¼Œå¯¼è‡´é¡µé¢æ ·å¼/äº¤äº’å¤±æ•ˆï¼›
3. æ ¸å¿ƒé€»è¾‘ï¼š`@WebFilter("/*")`ä¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ï¼Œé€šè¿‡åç¼€åˆ¤æ–­æ’é™¤é™æ€èµ„æºï¼Œåªå¯¹ä¸šåŠ¡è¯·æ±‚åšç™»å½•æ ¡éªŒã€‚

ç®€å•è¯´ï¼šæµè§ˆå™¨ç¡®å®ä¼šå•ç‹¬è¯·æ±‚JS/CSSç­‰èµ„æºï¼Œä½ çš„æ’é™¤é€»è¾‘æ˜¯å¿…è¦çš„ï¼Œå¦åˆ™é¡µé¢ä¼šåŠ è½½å¤±è´¥ã€‚